<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>
      {{ block "title" . }}
        {{ .Site.Title }}
      {{ end }}
    </title>
  </head>
  <body id="load">
    <header>
      {{ block "header" . }}
      {{ end }}
    </header>
    <main class="load">
      {{ block "main" . }}
      {{ end }}
    </main>
    <footer>
      {{ block "footer" . }}
      {{ end }}
    </footer>
  </body>
  <script src="//cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script>
  <script async src="//www.googletagmanager.com/gtag/js?id={{ .Site.GoogleAnalytics }}"></script>
<script>
  Barba.Dispatcher.on( 'newPageReady', function( currentStatus, oldStatus, container, newPageRawHTML ) {
    if ( Barba.HistoryManager.history.length === 1 ) {
        return;
    }
    var head = document.head,
        newPageRawHead = newPageRawHTML.match( /<head[^>]*>([\s\S.]*)<\/head>/i )[ 0 ],
        newPageHead = document.createElement( 'head' );
    newPageHead.innerHTML = newPageRawHead;
    var headTags = [
        "meta[name='keywords']",
        "meta[name='description']",
        "meta[property^='og']",
        "meta[name^='twitter']",
        "meta[itemprop]",
        "link[itemprop]",
        "link[rel='prev']",
        "link[rel='next']",
        "link[rel='canonical']",
        "link[rel='alternate']"
    ].join( ',' );
    var oldHeadTags = head.querySelectorAll( headTags );
    for (var i = 0, len = oldHeadTags.length; i < len; i++) {
        head.removeChild( oldHeadTags[ i ] );
    }
    var newHeadTags = newPageHead.querySelectorAll( headTags );
    for (var i = 0, len = newHeadTags.length; i < len; i++) {
        head.appendChild( newHeadTags[ i ] );
    }
});

  var HideShowTransition = Barba.BaseTransition.extend({
    start: function() {
      this.newContainerLoading.then(this.finish.bind(this));
    },
    finish: function() {
      document.body.scrollTop = 0;
      this.done();
    }
  });

  Barba.Pjax.getTransition = function() {
    return HideShowTransition;
  };

  Barba.Pjax.Dom.wrapperId = 'load';
  Barba.Pjax.Dom.containerClass = 'load';
  Barba.Pjax.start();

  Barba.Dispatcher.on('initStateChange', function() {
  if (typeof gtag === 'function' && Barba.HistoryManager.history.length >= 1) {
    gtag('config', '{{ .Site.GoogleAnalytics }}', {'page_path': location.pathname});
  }
});

var site_url = location.protocol + '//' + location.host;
if (!element.href.startsWith(site_url)) {
    element.setAttribute('target','_blank');
    return false;
}

var url = location.protocol + '//' + location.host + location.pathname;
var extract_hash = element.href.replace(/#.*$/,"");
if (element.href.startsWith(location.protocol + '//' + location.host)) {
    if (element.href.indexOf('#') > -1 &&  extract_hash != url ){
        return true;
    }
}
function scroll(){
  // ヘッダー追従かどうか
    var headerFixed = false;
    // URLに「#」が存在するか
    if(location.hash){
        var anchor = document.querySelector( location.hash );
        if(anchor){
            var rect = anchor.getBoundingClientRect();
            var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if(headerFixed){
                var header = document.getElementById('header');
                if(header){
                    top = top - header.clientHeight;
                }
            }
            var top = rect.top + scrollTop;
            window.scrollTo(0,top);
        }else{
          // アンカー先が存在しなければページトップに
            window.scrollTo(0,0);
        }
    }else{
      // URLに「#」が存在しなければページトップに
        window.scrollTo(0,0);
    }
}
Barba.Dispatcher.on('transitionCompleted',scroll);

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('sw.js');
    });
  }
</script>
</html>
